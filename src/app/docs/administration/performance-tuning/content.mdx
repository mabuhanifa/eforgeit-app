# Performance Tuning

Optimizing PostgreSQL performance involves a combination of good database design, efficient queries, and proper server configuration.

## Query Analysis with `EXPLAIN`

The `EXPLAIN` command is your most important tool for understanding and optimizing query performance. It shows the execution plan that the PostgreSQL planner generates for a given statement.

```sql
EXPLAIN SELECT * FROM users WHERE id = 123;
```

To get more details, including actual execution times, use `EXPLAIN ANALYZE`.

```sql
EXPLAIN ANALYZE SELECT * FROM users WHERE email LIKE 'a%';
```

This will run the query and show you how long each step took, how many rows were returned, etc. Look for slow parts of the plan, like sequential scans on large tables, and see if they can be optimized (e.g., by adding an index).

## Server Configuration

Many performance-related settings are in `postgresql.conf`. Some of the most important ones to consider are:

- `shared_buffers`: Sets the amount of memory the database server uses for shared memory buffers. A good starting point is 25% of your system's memory.
- `work_mem`: The amount of memory to be used by internal sort operations and hash tables before writing to temporary disk files.
- `maintenance_work_mem`: Memory used for maintenance tasks, like `VACUUM`, `CREATE INDEX`, and `ALTER TABLE ADD FOREIGN KEY`.
- `effective_cache_size`: An estimate of how much memory is available for disk caching by the operating system and within the database itself.

## Vacuuming

PostgreSQL uses Multi-Version Concurrency Control (MVCC) to handle concurrent transactions. This means that when rows are updated or deleted, the old versions are not immediately removed. The `VACUUM` command reclaims storage occupied by these "dead" tuples.

While autovacuum is enabled by default and handles this in the background, manual `VACUUM` (especially `VACUUM FULL`) is sometimes needed.
