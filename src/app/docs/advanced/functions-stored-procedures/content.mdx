# Functions & Stored Procedures

PostgreSQL allows you to extend the database functionality with user-defined functions and stored procedures.

## Functions

A function is a set of SQL and procedural commands that returns a value. They are defined to execute within a query.

Here is an example of a simple function written in `PL/pgSQL` that returns the total number of employees.

```sql
CREATE FUNCTION total_employees() RETURNS integer AS $$
DECLARE
    total integer;
BEGIN
   SELECT count(*) into total FROM employees;
   RETURN total;
END;
$$ LANGUAGE plpgsql;

-- Call the function
SELECT total_employees();
```

## Stored Procedures

Stored procedures are similar to functions but are not designed to return a value and can handle transactions (`COMMIT`, `ROLLBACK`). They are called independently.

```sql
CREATE PROCEDURE transfer(
   sender int,
   receiver int,
   amount dec
)
LANGUAGE plpgsql
AS $$
BEGIN
   -- subtracting the amount from the sender's account
   UPDATE accounts
   SET balance = balance - amount
   WHERE id = sender;

   -- adding the amount to the receiver's account
   UPDATE accounts
   SET balance = balance + amount
   WHERE id = receiver;

   COMMIT;
END;$$;

-- Call the procedure
CALL transfer(1, 2, 500);
```
